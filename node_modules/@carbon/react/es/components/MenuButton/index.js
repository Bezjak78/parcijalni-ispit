/**
 * Copyright IBM Corp. 2016, 2023
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */

import { objectWithoutProperties as _objectWithoutProperties, slicedToArray as _slicedToArray, defineProperty as _defineProperty, extends as _extends } from '../../_virtual/_rollupPluginBabelHelpers.js';
import React__default, { useRef, useState } from 'react';
import PropTypes from 'prop-types';
import cx from 'classnames';
import { ChevronDown } from '@carbon/icons-react';
import Button from '../Button/Button.js';
import { Menu } from '../Menu/Menu.js';
import { useAttachedMenu } from '../../internal/useAttachedMenu.js';
import { useId } from '../../internal/useId.js';
import { useMergedRefs } from '../../internal/useMergedRefs.js';
import { usePrefix } from '../../internal/usePrefix.js';

var _excluded = ["children", "className", "disabled", "kind", "label", "size"];
var spacing = 4; // top and bottom spacing between the button and the menu. in px

var validButtonKinds = ['primary', 'tertiary', 'ghost'];
var defaultButtonKind = 'primary';
var MenuButton = /*#__PURE__*/React__default.forwardRef(function MenuButton(_ref, forwardRef) {
  var children = _ref.children,
      className = _ref.className,
      disabled = _ref.disabled,
      _ref$kind = _ref.kind,
      kind = _ref$kind === void 0 ? defaultButtonKind : _ref$kind,
      label = _ref.label,
      _ref$size = _ref.size,
      size = _ref$size === void 0 ? 'lg' : _ref$size,
      rest = _objectWithoutProperties(_ref, _excluded);

  var id = useId('MenuButton');
  var prefix = usePrefix();
  var triggerRef = useRef(null);
  var menuRef = useRef(null);
  var ref = useMergedRefs([forwardRef, triggerRef]);

  var _useState = useState(0),
      _useState2 = _slicedToArray(_useState, 2),
      width = _useState2[0],
      setWidth = _useState2[1];

  var _useAttachedMenu = useAttachedMenu(triggerRef),
      open = _useAttachedMenu.open,
      x = _useAttachedMenu.x,
      y = _useAttachedMenu.y,
      hookOnClick = _useAttachedMenu.handleClick,
      handleMousedown = _useAttachedMenu.handleMousedown,
      handleClose = _useAttachedMenu.handleClose;

  function handleClick() {
    if (triggerRef.current) {
      var _triggerRef$current$g = triggerRef.current.getBoundingClientRect(),
          w = _triggerRef$current$g.width;

      setWidth(w);
      hookOnClick();
    }
  }

  function handleOpen() {
    menuRef.current.style.width = "".concat(width, "px");
  }

  var triggerClasses = cx("".concat(prefix, "--menu-button__trigger"), _defineProperty({}, "".concat(prefix, "--menu-button__trigger--open"), open), className);
  var buttonKind = validButtonKinds.includes(kind) ? kind : defaultButtonKind;
  return /*#__PURE__*/React__default.createElement(React__default.Fragment, null, /*#__PURE__*/React__default.createElement(Button, _extends({}, rest, {
    ref: ref,
    className: triggerClasses,
    size: size,
    kind: buttonKind,
    renderIcon: ChevronDown,
    disabled: disabled,
    "aria-haspopup": true,
    "aria-expanded": open,
    onClick: handleClick,
    onMouseDown: handleMousedown,
    "aria-owns": open ? id : null
  }), label), /*#__PURE__*/React__default.createElement(Menu, {
    ref: menuRef,
    id: id,
    label: label,
    size: size,
    open: open,
    onClose: handleClose,
    onOpen: handleOpen,
    x: x,
    y: [y[0] - spacing, y[1] + spacing]
  }, children));
});
MenuButton.propTypes = {
  /**
   * A collection of MenuItems to be rendered as actions for this MenuButton.
   */
  children: PropTypes.node.isRequired,

  /**
   * Additional CSS class names.
   */
  className: PropTypes.string,

  /**
   * Specify whether the MenuButton should be disabled, or not.
   */
  disabled: PropTypes.bool,

  /**
   * Specify the type of button to be used as the base for the trigger button.
   */
  kind: PropTypes.oneOf(validButtonKinds),

  /**
   * Provide the label to be renderd on the trigger button.
   */
  label: PropTypes.string.isRequired,

  /**
   * Specify the size of the button and menu.
   */
  size: PropTypes.oneOf(['sm', 'md', 'lg'])
};

export { MenuButton };
